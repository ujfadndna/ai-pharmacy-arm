# 机械臂手动校准指南

## 概述

本系统采用**无限位开关**设计，通过手动校准确定机械臂零点位置。每次开机后需执行一次校准。

---

## 准备工作

### 硬件检查

- [ ] RA6M5主控板已上电
- [ ] 电机驱动已上电（CAN通信正常）
- [ ] 串口调试助手已连接（115200波特率）
- [ ] WiFi模块已连接（可选，校准不需要）

### 工具准备

- 串口调试助手（推荐：SSCOM、Putty）
- 机械臂可自由活动（电机未使能或处于自由状态）

---

## 校准步骤

### 第1步：进入自由状态

确保电机处于**未使能**状态，可以手动转动各关节。

> 如果电机已使能锁定，发送命令释放：
> ```
> motor_free
> ```

### 第2步：摆放初始姿态

将机械臂**手动**摆放到以下姿态：

```
        ← 大臂水平向前
       ╱
      ╱  J2 = 90° (肩关节水平)
     ●
     │\
     │ \  J3 = -90° (肘关节向下弯曲)
     │  \
     │   ●
     │   │
     │   │  J5 = 90° (手腕朝下)
     │   ↓
     │  夹爪
     │
    ═●═  J1 = 90° (底座朝前)
   底座
```

### 各关节目标角度

| 关节 | 名称 | 目标角度 | 物理位置描述 |
|:----:|:----:|:--------:|:------------|
| J1 | 底座 | 90° | 大臂朝向正前方 |
| J2 | 肩部 | 90° | 大臂水平 |
| J3 | 肘部 | -90° | 小臂垂直向下 |
| J4 | 腕旋转 | 0° | 不旋转 |
| J5 | 腕俯仰 | 90° | 夹爪朝下 |
| J6 | 末端 | 0° | 夹爪不旋转 |

### 姿态参考图

**侧视图：**
```
         J2(肩)
          ●━━━━━━━━→ 大臂水平
          │
          │ J3(肘)
          ●
          │
          │ 小臂垂直
          │
          ● J5(腕)
          │
          ↓ 夹爪朝下
```

**俯视图：**
```
          前
          ↑
          │
    ←─────●─────→  大臂朝前
    左   底座   右
```

### 第3步：发送校准命令

在串口调试助手中输入：

```
home
```

### 第4步：确认校准成功

应看到以下输出：

```
[HOME] Setting current position as home...
  Joints: 90, 90, -90, 0, 90, 0 (deg)
[HOME] Done! Arm is now at home position.
```

### 第5步：验证校准（可选）

输入测试命令，验证IK是否正常：

```
t 0 0 0
```

应看到：
```
[TEST] IK for offset: x=0 y=0 z=0
[MOTION] Target xyz: 0, -47, 15
[MOTION] IK result: 90 90 -90 0 90 0 deg
[MOTION] Executing...
[TEST] IK OK!
```

如果IK结果与初始角度相同（90 90 -90 0 90 0），说明校准成功。

---

## 校准精度要求

| 关节 | 允许误差 | 说明 |
|:----:|:--------:|:-----|
| J1 | ±5° | 影响左右方向 |
| J2 | ±3° | 影响前后方向，较敏感 |
| J3 | ±3° | 影响高度，较敏感 |
| J4 | ±10° | 影响末端旋转，不敏感 |
| J5 | ±5° | 影响夹爪角度 |
| J6 | ±10° | 影响夹爪旋转，不敏感 |

> 提示：J2和J3对精度要求较高，请仔细对准。

---

## 常见问题

### Q1: 校准后IK经常失败？

**原因**：初始姿态摆放不准确

**解决**：
1. 重新摆放，确保大臂水平、小臂垂直向下
2. 使用水平尺辅助对准
3. 重新发送 `home` 命令

### Q2: 机械臂运动方向反了？

**原因**：电机方向配置错误

**解决**：检查 `motor_can.c` 中的电机方向配置

### Q3: 运动范围比预期小？

**原因**：关节限位约束

**说明**：这是正常现象，ZERO机械臂的J2限位为90°~180°，无法向前下方伸展。参考工作空间扫描结果规划药柜位置。

### Q4: 每次都要手动校准吗？

**是的**。无限位开关设计需要每次开机校准。

**替代方案**：
- 使用ZDT电机的绝对编码器记录位置
- 添加限位开关（接线复杂）

---

## 快速校准清单

开机后快速校准：

```
□ 1. 手动摆正机械臂（大臂水平、小臂垂直、夹爪朝下）
□ 2. 串口输入 "home" 回车
□ 3. 看到 "[HOME] Done!" 表示成功
□ 4. 可选：输入 "t 0 0 0" 验证
```

---

## 附录：完整命令列表

| 命令 | 功能 | 示例 |
|:-----|:-----|:-----|
| `home` | 设置当前位置为初始姿态 | `home` |
| `t x y z` | 测试IK（偏移量，单位mm） | `t 0 0 30` |
| `scan` | 扫描可达工作空间 | `scan` |
| `<文字>` | 发送到LLM处理 | `帮我拿阿莫西林` |

---

*文档版本：v1.0*
*最后更新：2026-01-28*
